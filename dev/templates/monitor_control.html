<html lang="ru" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Рабочий стол">
    <title>Рабочий стол</title>
    <th:block th:insert="base :: links"/>
</head>

<body th:style="${'background: ' + bgColor.color + ';'}" class="page custom-scroll">
    <div class="page__content">
        <div th:replace="base :: main-nav"></div>

        <div class="platform__wrapper">
            <div class="platform__header monitor">
                <h1 class="platform__title">
                    Рабочий стол
                    <span js-update-background
                          class="theme-setting theme-setting_black content-top__settings--main content-monitor__settings"></span>
                </h1>
                <div th:replace="base :: monitor-tabs"></div>
            </div>
            <div class="platform__content monitor">
                <div class="platform__nav">
                    <div class="platform__nav--left">
                        <div class="platform__filter--btn no-selector">Фильтр</div>
                    </div>
                    <div class="platform__nav--right">
                        <form action="#" th:action="@{/monitor-control/}" th:object="${filter}" th:method="post"
                              class="content-main__panel-side">
                            <div
                                class="input-element__input input-element__input_black input-element__input_transp input-element__input_row input-element__input_l30">
                                <div class="input-element__radio input-element__radio_small">
                                    <input filter-parameter type="radio" id="Сегодня" class="radio radio-mech"
                                           th:field="*{period}"
                                           th:value="1" th:checked="${filter.period == 1}">
                                    <label for="Сегодня">Сегодня</label>
                                </div>
                                <div class="input-element__radio-delim"></div>
                                <div class="input-element__radio input-element__radio_small">
                                    <input filter-parameter type="radio" id="Вчера" class="radio radio-mech"
                                           th:field="*{period}" th:value="2"
                                           th:checked="${filter.period == 2}">
                                    <label for="Вчера">Вчера</label>
                                </div>
                                <div class="input-element__radio-delim"></div>
                                <div class="input-element__radio input-element__radio_small">
                                    <input filter-parameter type="radio" id="Неделя" class="radio radio-mech"
                                           th:field="*{period}"
                                           th:value="3" th:checked="${filter.period == 3}">
                                    <label for="Неделя">Неделя</label>
                                </div>
                                <div class="input-element__radio-delim"></div>
                                <div class="input-element__radio input-element__radio_small">
                                    <input filter-parameter type="radio" id="Месяц" class="radio radio-mech"
                                           th:field="*{period}" th:value="4"
                                           th:checked="${filter.period == 4}">
                                    <label for="Месяц">Месяц</label>
                                </div>
                            </div>
                            <div th:if="${role != 'ROLE_ADMIN' && currentManager.isNeedShow}"
                                 class="input-element__input input-element__input_black input-element__input_transp input-element__input_row input-element__input_l30">
                                <div class="input-element__radio input-element__radio_small">
                                    <input filter-parameter type="radio" id="Все" class="radio radio-mech"
                                           th:field="*{showType}"
                                           th:value="all" th:checked="${filter.showType == 'all'}">
                                    <label for="Все">Все</label>
                                </div>
                                <div class="input-element__radio-delim"></div>
                                <div class="input-element__radio input-element__radio_small">
                                    <input filter-parameter type="radio" id="Мои" class="radio radio-mech"
                                           th:field="*{showType}"
                                           th:value="self" th:checked="${filter.showType == 'self'}">
                                    <label for="Мои">Мои</label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="content-main__panel monitor-panel__widgets widgets content-main__panel_large">
                    <div class="tiles__wrapper">
                        <div class="tile tile_small tile__control">
                            <div class="tooltip-item">
                                <div class="tooltip-content">
                                    <div class="c-tooltip__text">Количество проверенных сделок</div>
                                </div>
                                <span>?</span>
                            </div>
                            <div class="tile__title tile__title_handshake">Проверено сделок</div>
                            <div class="tile__text tile__text--control" th:utext="${generalRow.dealCount}"></div>
                        </div>
                        <div class="tile tile_small tile__control">
                            <div class="tooltip-item">
                                <div class="tooltip-content">
                                    <div class="c-tooltip__text">Количество проставленных оценок</div>
                                </div>
                                <span>?</span>
                            </div>
                            <div class="tile__title tile__title_estimation">Поставлено оценок</div>
                            <div class="tile__text tile__text--control" th:utext="${generalRow.rateCount}"></div>
                        </div>
                        <div class="tile tile_small tile__control">
                            <div class="tooltip-item">
                                <div class="tooltip-content">
                                    <div class="c-tooltip__text">Количество разрешенных споров</div>
                                </div>
                                <span>?</span>
                            </div>
                            <div class="tile__title tile__title_dispute">Споров отработано</div>
                            <div class="tile__text tile__text--control" th:text="${generalRow.debateCount}"></div>
                        </div>
                        <div class="tile tile_small tile__control">
                            <div class="tooltip-item">
                                <div class="tooltip-content">
                                    <div class="c-tooltip__text">Количество измененных оценок в спорах</div>
                                </div>
                                <span>?</span>
                            </div>
                            <div class="tile__title tile__title_change">Изменений оценок в спорах</div>
                            <div class="tile__text tile__text--control" th:text="${generalRow.debateCount}"></div>
                        </div>
                        <div class="tile tile_small tile__control">
                            <div class="tooltip-item">
                                <div class="tooltip-content">
                                    <div class="c-tooltip__text">Средняя оценка менеджеров</div>
                                </div>
                                <span>?</span>
                            </div>
                            <div class="tile__title average">
                                <div class="tile__icons">
                                    <span class="tile__icon tile__title_estimation-average"></span>
                                </div>
                                Средняя оценка
                            </div>
                            <div class="tile__text tile__text--control" th:text="${generalRow.score}"></div>
                        </div>
                    </div>
                </div>
                <div class="content-main__panel monitor-panel__table monitor-table__wrapper content-main__panel_large content-main__panel_p">
                    <div class="big-tile">
                        <div class="tooltip-item">
                            <div class="tooltip-content">
                                <div class="c-tooltip__text">Общий монитор работы менеджеров
                                </div>
                            </div>
                            <span>?</span>
                        </div>
                        <div class="tile__title tile__title_margin tile__title_cup">
                            <span>Рейтинг</span>
                            <form action="#" th:object="${filter}" th:action="@{/monitor-control/}" th:method="post"
                                  class="transparent-selector">
                                <select th:field="*{rowSortType}" filter-parameter class="transparent-selector__selector">
                                    <option value="1">по оценке</option>
                                    <option value="2">по спорам</option>
                                    <option value="3">по сделкам</option>
                                </select>
                            </form>
                        </div>

                        <table class="monitor-table">
                            <thead class="monitor-table__header">
                            <tr class="monitor-table__row monitor-manager">
                                <td class="monitor-table__col monitor-manager__index"></td>
                                <td class="monitor-table__col monitor-manager__info no-border">Менеджер</td>
                                <td class="monitor-table__col monitor-manager__checked no-border">Проверено сделок</td>
                                <td class="monitor-table__col monitor-manager__estimation no-border">Поставлено оценок
                                </td>
                                <td class="monitor-table__col monitor-manager__dispute no-border">Споров отработано</td>
                                <td class="monitor-table__col monitor-manager__change no-border">Изменений оценок в спорах
                                </td>
                                <td class="monitor-table__col monitor-manager__average">Средняя оценка</td>
                            </tr>
                            </thead>
                            <tbody class="monitor-table__body">
                            <tr class="monitor-table__row monitor-manager" th:each="row, stat : ${managersRows}">
                                <td class="monitor-table__col monitor-manager__index" th:text="${stat.count}"></td>
                                <td class="monitor-table__col monitor-manager__info">
                                    <div class="employee">
                                        <div class="employee__avatar c-tooltip">
                                            <div class="c-tooltip__wrapper c-tooltip__wrapper_avatar"
                                                 th:if="${(row.manager.avatar != null || !#strings.isEmpty(row.manager.avatar))}">
                        <span class="c-tooltip__avatar">
                                                    <img th:if="${row.manager.avatar}"
                                                         th:src="'/' + ${row.manager.avatar}" alt="">
                                                </span>
                                            </div>
                                            <div class="avatar">
                                                <div class="avatar__wrapper avatar__wrapper_bordered"
                                                     th:style="'border-color: ' + ${(row.manager.type == '#481E8C') ? 'black' : '#FF284F' } + ';'">
                          <span class="avatar-image"
                                th:classappend="${(row.manager.avatar == null || #strings.isEmpty(row.manager.avatar)) ? 'avatar-image_default' : ''}">
                                                        <img th:if="${row.manager.avatar}"
                                                             th:src="'/' + ${row.manager.avatar}" alt="">
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="employee__desc">
                                            <div class="employee-name" th:utext="${row.manager.name}"></div>
                                            <div class="employee-score employee-score__control"
                                                 th:utext="${row.manager.typeTitle}"></div>
                                        </div>
                                    </div>
                                </td>
                                <td class="monitor-table__col monitor-manager__checked" th:text="${row.dealCount}"></td>
                                <td class="monitor-table__col monitor-manager__estimation" th:text="${row.rateCount}">
                                </td>
                                <td class="monitor-table__col monitor-manager__dispute" th:text="${row.debateCount}">
                                </td>
                                <td class="monitor-table__col monitor-manager__change" th:text="${row.debateCount}">
                                </td>
                                <td class="monitor-table__col monitor-manager__average" th:text="${row.score}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

<div th:replace="base :: transition-loader"></div>
<script th:src="@{/js/transition-loader.js}"></script>
<script th:inline='javascript'>
    /*<![CDATA[*/
    showLoader();
/*]]>*/
</script>

<div class="platform__filter">
    <div class="filter__wrapper">
        <div class="filter__head">
            <h2 class="filter__title">Фильтровать монитор</h2>
            <span class="platform__close--btn-modal"></span>
        </div>
        <div class="filter__content custom-scroll">
            <form class="filter__form" action="#" th:action="@{/monitor-control/}" th:method="post">
                <ul class="filter__column">
                    <li class="filter__item width_100">
                        <h3 class="filter__subtitle">Параметры</h3>
                    </li>
                    <li class="filter__item">
                        <p class="filter__name">Проекты</p>
                        <div class="platform-select__wrapper filter__select-wrapper">
                            <select class="platform__select filter__select" name="projectId">
                                <option class="filter-select__option" th:value="0" selected>Все проекты</option>
                                <option class="filter-select__option" th:each="project : ${projects}"
                                        th:value="${project.id}"
                                        th:utext="${project.name}"></option>
                            </select>
                        </div>
                    </li>
                </ul>
            </form>
        </div>
        <div class="filter__footer">
            <div class="filter__apply">Применить фильтры</div>
            <form th:if="${filter.canClear}" action="#" th:action="@{/monitor-control/clearFilter}" th:object="${filter}"
                  th:method="post"
                  class="filter__stop">
                <button type="submit" class="filter__reset">
                    <span class="filter__reset--icon"></span>
                    Сбросить фильтры
                </button>
            </form>
        </div>
    </div>
</div>
<div th:replace="base :: menu-update-background"></div>

<script th:inline="javascript">
    window.onload = function () {
        var theList = [[${ actionBanners }]];

        if (theList && theList.length) {
            for (i = 0; i < theList.length; i++) {
                if (theList[i].wasStarted) {
                    initializeClock(theList[i].id, theList[i].nowDate, theList[i].endDate);
                }
            }
        }
    };
</script>

<div class="c-tooltip__wrapper c-tooltip__wrapper_right tooltip-wrapper"></div>
<div class="c-tooltip__wrapper c-tooltip__wrapper_maxwidth tooltip-wrapper"></div>

<th:block th:insert="base :: scripts"/>
<script th:src="@{/js/timer.js}"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var filter = [[${ filter }]];
    var items = null;
    var role = [[${ role }]];
    var today = [[${ dates }]];
    var manager = null;
    var company = [[${ company }]];
    var managers = null;
/*]]*/
</script>
</body>

</html>